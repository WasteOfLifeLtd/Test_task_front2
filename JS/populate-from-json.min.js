Array.from||(Array.from=function(){var t=Object.prototype.toString,e=function(e){return"function"==typeof e||"[object Function]"===t.call(e)},n=Math.pow(2,53)-1,i=function(t){var e,i=(e=Number(t),isNaN(e)?0:0!==e&&isFinite(e)?(e>0?1:-1)*Math.floor(Math.abs(e)):e);return Math.min(Math.max(i,0),n)};return function(t){var n=Object(t);if(null==t)throw new TypeError("Array.from requires an array-like object - not null or undefined");var a,r=arguments.length>1?arguments[1]:void 0;if(void 0!==r){if(!e(r))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(a=arguments[2])}for(var o,c=i(n.length),d=e(this)?Object(new this(c)):new Array(c),u=0;u<c;)o=n[u],d[u]=r?void 0===a?r(o,u):r.call(a,o,u):o,u+=1;return d.length=c,d}}());var templateProduct,productsJson,productsPerPage=3,page=1;function selectItemsForPage(t,e,n){var i=[];if(1==t){$(".products_page").append(templateProduct),handleTemplateProductFunctionality();for(var a=0;a<e-1;a++)i.push(n[a])}else{templateProduct.remove();for(a=0;a<e;a++){var r=n[e*t-e-1+a];void 0!==r&&i.push(r)}}return i}function createPagination(t,e,n){var i=Math.ceil(e/n),a=$("<ul></ul>").addClass("pagination"),r=$('<li><a href="#">1</a></li>'),o=$('<li><a href="#">'+i+"</a></li>"),c=r.clone(),d=r.clone(),u=r.clone();function s(t){switch(c.find("a").text(t-1),d.find("a").text(parseInt(t)+1),u.find("a").text(t),t){case 1:a.find(">:lt(3)").hide(),a.find(">:gt(2)").show();break;case 2:a.find(">:lt(2)").hide(),a.find(">:gt(1)").show();break;case 3:a.find(">:eq(1)").hide(),a.find(">:not(:eq(1))").show();break;case i-2:a.find(">:eq(5)").hide(),a.find(">:not(:eq(5))").show();break;case i-1:a.find(">:eq(4), >:eq(5)").hide(),a.find(">:not(:eq(5), :eq(4))").show();break;case i:a.find(">:gt(3)").hide(),a.find(">:lt(4)").show();break;default:a.children().show()}}u.addClass("active"),a.append(r),a.append($("<li><span>...</span></li>")),a.append(c),a.append(u),a.append(d),a.append($("<li><span>...</span></li>")),a.append(o),a.find("li:not(.active) a, li:not(.active) span").hover(function(){$(this).css("background-color","#fff")}),s(t),a.find("a").click(function(){$(".product_horizontal").remove(),$.each(selectItemsForPage($(this).text(),n,productsJson),function(t,e){createProductCard(e)}),s(parseInt($(this).text()))}),$(".product__area").append(a)}function createProductCard(t){var e=templateProduct.clone().show();$(".products_page:first").append(e),e.find(".product_code").text("Код: "+t.code.replace(/^0*/,"")),e.find(".product_photo img").attr("src",t.primaryImageUrl.replace(".jpg","_220x220_1.jpg")),e.find(".product_description .product__link").text(t.title),e.find(".product_tags").children().not("p, a:first").remove();var n=Array.from(new Set(t.assocProducts.split(";").filter(function(t,e,n){return e==n.indexOf(t)})));$.each(n,function(t,i){i=0==t?" "+i:i,i+=t<n.length-1?",":".",e.find(".product_tags").append(e.find(".product_tags a:first").clone().text(i))}),e.find(".product_tags a:first-of-type").remove(),e.find(".goldPrice").text(t.priceGold),e.find(".retailPrice").text(t.priceRetail),e.find(".product_units p:first").text(function(){switch(t.unitAlt){case"упак.":return"За упаковку";case"шт.":return"За штуку";case"м. кв.":return"За "+t.unitAlt}}),e.find(".product_units p:last").text(function(){if(t.unit==t.unitAlt)e.find(".product_units p:last").hide();else switch(t.unitFull){case"упаковка":return"За упаковку";case"штука":return"За штуку";case"метр погонный":return"За "+t.unitFull}}),e.find(".unit--info span:first").text(function(){var n="";switch(t.unit){case"упак.":n="Продается упаковками:";break;case"шт.":n="Продается поштучно:",e.find(".unit--desc-i").css("marginTop",0);break;case"м/п":n="Продается погонными метрами:",e.find(".list--unit-desc").css("paddingRight",0).css("paddingLeft",0),e.find(".unit--desc-i").css("marginRight",0)}return t.unit==t.unitAlt?n.replace(":",""):n});var i=e.find(".unit--info span:last");i.text(function(){if(t.unit!=t.unitAlt)return t.unitRatio+" "+t.unit+" = "+Math.round(100*t.unitRatioAlt)/100+" "+t.unitAlt;i.hide()}),e.find(".unit--wrapper .unit--select").click(function(){$(this).hasClass("unit--active")||($(this).addClass("unit--active"),$(this).siblings().removeClass("unit--active"),e.find(".goldPrice").text(0==$(this).index()?t.priceGold:Math.round(100*t.priceGoldAlt)/100),e.find(".retailPrice").text(0==$(this).index()?t.priceRetail:Math.round(100*t.priceRetailAlt)/100))});var a=e.find(".stepper-input");function r(){e.find(".unit--info span:last").text(a.val()+" "+t.unit+" = "+Math.round(t.unitRatioAlt*parseInt(a.val())*100)/100+" "+t.unitAlt)}a.change(function(){r()}),e.find(".stepper .up").click(function(){a.val(parseInt(a.val())+1),r()}),e.find(".stepper .down").click(function(){a.val(1==a.val()?1:parseInt(a.val())-1),r()}),e.find(".btn_cart").attr("data-product-id",t.productId)}function handleTemplateProductFunctionality(){var t=templateProduct.find(".stepper-input");function e(){templateProduct.find(".unit--info span:last").text(t.val()+" упак. = "+Math.round(2.47*parseInt(t.val())*100)/100+" м. кв")}t.change(function(){e()}),templateProduct.find(".stepper .up").click(function(){t.val(parseInt(t.val())+1),e()}),templateProduct.find(".stepper .down").click(function(){t.val(1==t.val()?1:parseInt(t.val())-1),e()}),templateProduct.find(".unit--wrapper .unit--select").click(function(){$(this).hasClass("unit--active")||($(this).addClass("unit--active"),$(this).siblings().removeClass("unit--active"),templateProduct.find(".goldPrice").text(Math.floor(1e3*Math.random())),templateProduct.find(".retailPrice").text(900*parseFloat(templateProduct.find(".goldPrice").text())/1e3))})}$(document).ready(function(){templateProduct=$(".product_horizontal:first"),$.getJSON("products.json").done(function(t){productsJson=t;var e=selectItemsForPage(page,productsPerPage,t);$.each(e,function(t,e){createProductCard(e)}),createPagination(page,t.length,productsPerPage)})});